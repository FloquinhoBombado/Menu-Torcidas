local Player = game.Players.LocalPlayer
local PlayerGui = Player:WaitForChild("PlayerGui")

local existingGui = PlayerGui:FindFirstChild("KillAllMenu")
if existingGui then
	existingGui:Destroy()
	return
end

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "KillAllMenu"
ScreenGui.Parent = PlayerGui
ScreenGui.ResetOnSpawn = false

local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 400, 0, 200)
MainFrame.Position = UDim2.new(0.5, -200, 0.5, -100)
MainFrame.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
MainFrame.BorderSizePixel = 0
MainFrame.Parent = ScreenGui

local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 15)
UICorner.Parent = MainFrame

local UIStroke = Instance.new("UIStroke")
UIStroke.Color = Color3.fromRGB(200, 200, 200)
UIStroke.Thickness = 2
UIStroke.Parent = MainFrame

local Title = Instance.new("TextLabel")
Title.Text = "Menu Torcidas | by Floquinho"
Title.Size = UDim2.new(1, 0, 0, 40)
Title.BackgroundTransparency = 1
Title.TextColor3 = Color3.fromRGB(240, 240, 240)
Title.Font = Enum.Font.SourceSansBold
Title.TextSize = 24
Title.Parent = MainFrame

local KillAllButton = Instance.new("TextButton")
KillAllButton.Text = "Executar Kill-All"
KillAllButton.Size = UDim2.new(0, 200, 0, 50)
KillAllButton.Position = UDim2.new(0.5, -100, 0, 80)
KillAllButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
KillAllButton.TextColor3 = Color3.fromRGB(240, 240, 240)
KillAllButton.Font = Enum.Font.SourceSansBold
KillAllButton.TextSize = 20
KillAllButton.Parent = MainFrame

local UICorner2 = Instance.new("UICorner")
UICorner2.CornerRadius = UDim.new(0, 10)
UICorner2.Parent = KillAllButton

local Players = game:GetService("Players")
local LocalPLR = Players.LocalPlayer
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")

local dragging = false
local dragInput, dragStart, startPos

MainFrame.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 then
		dragging = true
		dragStart = input.Position
		startPos = MainFrame.Position
		input.Changed:Connect(function()
			if input.UserInputState == Enum.UserInputState.End then
				dragging = false
			end
		end)
	end
end)

MainFrame.InputChanged:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseMovement then
		dragInput = input
	end
end)

RunService.RenderStepped:Connect(function()
	if dragging and dragInput then
		local delta = dragInput.Position - dragStart
		MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
	end
end)

local function GetCharacterParts()
	local Char = LocalPLR.Character or LocalPLR.CharacterAdded:Wait()
	local Soco = Char:FindFirstChild("Soco")
	if not Soco then
		game:GetService("StarterGui"):SetCore("SendNotification", {
			Title = "Menu Torcidas (ERRO)";
			Text = "Equipe a o soco :nerd:";
			Duration = 5,
		})
		return nil, nil, nil, nil
	end
	local HumanoidRoot = Char:FindFirstChild("HumanoidRootPart")
	local Event = Soco:FindFirstChild("Combo") and Soco.Combo:FindFirstChild("C1")
	local RightArm = Char:FindFirstChild("Right Hand") or Char:FindFirstChild("RightHand") or Char:FindFirstChild("Right Arm")
	return Char, HumanoidRoot, Event, RightArm
end

local function IsNearSafezone(targetPos)
	local Safezones = Workspace:FindFirstChild("Safezones")
	if not Safezones then return false end
	for _, zone in pairs(Safezones:GetChildren()) do
		if zone:IsA("BasePart") then
			if (zone.Position - targetPos).Magnitude <= 10 then
				return true
			end
		end
	end
	return false
end

KillAllButton.MouseButton1Click:Connect(function()
	local Char = LocalPLR.Character or LocalPLR.CharacterAdded:Wait()
	if LocalPLR.TeamColor ~= BrickColor.new(302) then
		game:GetService("StarterGui"):SetCore("SendNotification", {
			Title = "Menu Torcidas";
			Text = "Entrando no time...";
			Duration = 3,
		})
		task.wait(1)
		pcall(function()
			local args = { BrickColor.new(302) }
			game:GetService("ReplicatedStorage"):WaitForChild("ChangeTeamEvent"):FireServer(unpack(args))
		end)
	else
		game:GetService("StarterGui"):SetCore("SendNotification", {
			Title = "Menu Torcidas (AVISO)";
			Text = "Tudo certo, começando a 2° parte;";
			Duration = 3,
		})
	end

	task.wait(1)

	local Char, HumanoidRoot, Event, RightArm = GetCharacterParts()
	if not (Char and HumanoidRoot and Event and RightArm) then return end

	local count = 0
	game:GetService("StarterGui"):SetCore("SendNotification", {
		Title = "Menu Torcidas (AVISO)";
		Text = "Executando Kill-All...";
		Duration = 5,
	})

	for _, plr in pairs(Players:GetPlayers()) do
		if plr ~= LocalPLR and plr.TeamColor ~= LocalPLR.TeamColor then
			local character = plr.Character
			if character then
				local humanoid = character:FindFirstChild("Humanoid")
				local targetHRP = character:FindFirstChild("HumanoidRootPart")
				if humanoid and targetHRP and humanoid.Health > 0 and not character:FindFirstChildOfClass("ForceField") then
					if IsNearSafezone(targetHRP.Position) then
						continue
					end
					repeat
						if HumanoidRoot and targetHRP then
							HumanoidRoot.CFrame = targetHRP.CFrame + Vector3.new(0,5,0)
						end
						pcall(function()
							Event:FireServer(RightArm)
						end)
						task.wait(0.05)
					until not humanoid or humanoid.Health <= 0 or character:FindFirstChildOfClass("ForceField")
					count += 1
					game:GetService("StarterGui"):SetCore("SendNotification", {
						Title = "Menu Torcidas";
						Text = "Players mortos: "..count;
						Duration = 3,
					})
				end
			end
		end
	end

	game:GetService("StarterGui"):SetCore("SendNotification", {
		Title = "Menu Torcidas (Finalizado)";
		Text = "Quantidade de players mortos: "..count;
		Duration = 5,
	})
end)

UserInputService.InputBegan:Connect(function(input, gpe)
	if not gpe and input.KeyCode == Enum.KeyCode.RightShift then
		MainFrame.Visible = not MainFrame.Visible
		game:GetService("StarterGui"):SetCore("SendNotification", {
			Title = "-- Menu Torcidas --";
			Text = MainFrame.Visible and "MENU ABERTO" or "MENU FECHADO";
			Duration = 3,
		})
	end
end)

